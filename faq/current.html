<!doctype html>
<html lang=en id=faq>

<title>Following -current and using snapshots</title>
<meta charset=utf-8>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="../openbsd.css">
<link rel="canonical" href="https://www.openbsd.org/faq/current.html">

<h2 id=OpenBSD>
<a href="../index.html">
<i>Open</i><b>BSD</b></a>
Following -current and using snapshots
<small>
<a href="index.html">[FAQ Index]</a>
</small>
</h2>
<hr>

<p>
Active OpenBSD development is known as the
<a href="faq5.html#Flavors">-current</a> branch.
These sources are frequently compiled into releases known as <i>snapshots</i>.

<p>
Aggressive changes are sometimes pushed in this branch, and complications can
arise when building the latest code or upgrading from a previous point in time.
Some of the steps for getting over these hurdles are explained on this page.
Make sure you've read and understand how to
<a href="faq5.html">build the system from source</a> before using -current
and the instructions below.

<p>
In general, it's far easier to use snapshots, as developers will have gone
through much of the trouble for you already.

<p>
You should <b>always</b> use a snapshot as the starting point for running
-current.
This process typically consists of running
<a href="https://man.openbsd.org/sysupgrade">sysupgrade(8)</a> with the
<code>-s</code> flag.
Alternatively, download (and verify) the appropriate
<a href="faq4.html#bsd.rd">bsd.rd</a> file from the <code>/snapshots/</code>
directory of your preferred <a href="../ftp.html">mirror</a>, boot from it,
and choose <code>(U)pgrade</code> at the prompt.
Any installed packages should then be
<a href="faq15.html#PkgUpdate">upgraded</a> after booting into the new system.

<p>
Upgrading to -current by compiling your own source code is discouraged
for everyone except for experts, as difficult build-time crossing-points
can occur often, and no assistance will be provided.  In case of failure,
use a snapshot to recover.

<p>
Most of these changes will have to be performed as root.



<h3 id="r20201107">2020/11/07 - iked.conf "to dynamic"</h3>

New keywords have been introduced to
<a href="https://man.openbsd.org/iked.conf">iked.conf(5)</a>
to simplify the configuration when using "config address".
Previously, when either "<code>to 0.0.0.0</code>" or "<code>to 0.0.0.0/0</code>" 
were used, they would be replaced with the peer's assigned address when
creating flows.
"<code>to dynamic</code>" has been introduced to make the configuration
syntax clearer.
<p>
"<code>to 0.0.0.0</code>" works as before but can be updated to the new
syntax if wanted.
<p>
"<code>to 0.0.0.0/0</code>" will now be treated literally;
if you want the old behaviour you must change to "<code>to dynamic</code>".


<h3 id="r20201216">2020/12/16 - pf port range validation</h3>

<a href="https://man.openbsd.org/pf">pf(4)</a> and
<a href="https://man.openbsd.org/pfctl">pfctl(8)</a> are now stricter
about validating rules which use port ranges.
<p>
The following show incorrect rules that were previously accepted:
"<code>port 2004:2000</code>", "<code>port 2004 &gt;&lt; 2000</code>",
"<code>port 2004 &lt;&gt; 2000</code>" (range should be low-high),
and "<code>port 2000 &gt;&lt; 2000</code>" (range should not be a single
port).
<p>
If you use ranges and don't have console access, check them <b>before</b>
upgrading.


<h3 id="r20201229">2020/12/29 - new sysctl setting to control video recording</h3>

Similar to how audio recording is handled, recording has been disabled
by default in <a href="https://man.openbsd.org/video">video(4)</a>.
It may be reenabled like this:

<blockquote><pre>
    # <b>sysctl kern.video.record=1</b> # enable at runtime
    # <b>echo kern.video.record=1 >> /etc/sysctl.conf</b> # set at boot
</pre></blockquote>


<h3 id="r20210116">2021/01/16 - sysctl forwarding for pf af-to</h3>

Even if forwarding was not configured, pf(4) allowed to forward
packets with af-to.
To continue using NAT64 you have to set these sysctl:

<blockquote><pre>
    # <b>sysctl net.inet.ip.forwarding=1</b>
    # <b>sysctl net.inet6.ip6.forwarding=1</b>
</pre></blockquote>


<h3 id="r20210118">2021/01/18 - www/rt config directory change</h3>

The update to 5.0.0 moves the default config directory from /etc/rt3 to
/etc/rt. Make sure to move all the modified configuration files to the new
path.


<h3 id="r20210122">2021/01/22 - snmpd traphandler changes</h3>

Cleanup in <a href="https://man.openbsd.org/snmpd">snmpd(8)</a>'s traphandler
code lead to the following changes:

<ul>
<li>Defining a trap handle now requires explicit enabling of notify
functionality on the listen socket, where it previously would enable a listen
socket on every UDP listen on statement.
For identical behaviour the UDP listen on statements need to be duplicated with
an notify flag appended.
<pre><code>
listen on 127.0.0.1
</code></pre>
would become
<pre><code>
listen on 127.0.0.1
listen on 127.0.0.1 notify
</code></pre>
<li>Incoming trap packets are now checked against trap community, where it
would previously ignore the community.</li>
<li>traphandler_v1translate now fully complies to RFC3584 section 3.1, where it
previously only implemented bullet (2) on generic-trap &gt;= 6.
People using SNMPv1 traps are encouraged to verify their trap handle scripts
before updating.
Handlers for generic-trap &lt; 6 need to modify their trap handle scripts and
potentially add trap handle statements in accordance with RFC3584 section 3.1
bullet (3).</li>
<li>Running <a href="https://man.openbsd.org/snmpd">snmpd(8)</a> without -N now
prints iso.org.dod.internet.mgmt.mib-2.system.sysUpTime.0 (first varbind) in
accordance with its internal MIB definitions
(iso.org.dod.internet.mgmt.mib_2.system.sysUpTime.0).</li>
<li>Running <a href="https://man.openbsd.org/snmpd">snmpd(8)</a> with -N now
prints iso.org.dod.internet.mgmt.mib-2.system.sysUpTime.0 (first varbind)
numerically (.1.3.6.1.2.1.1.3.0).</li>
<li>Running <a href="https://man.openbsd.org/snmpd">snmpd(8)</a> with -N now
prints
iso.org.dod.internet.snmpV2.snmpModules.snmpMIB.snmpMIBObjects.snmpTrap.snmpTrapOID.0
(second varbind) numerically (1.3.6.1.6.3.1.1.4.1.0).</li>
</ul>


<h3 id="r20210201">2021/02/01 - pf routing syntax changes</h3>

Syntax for PF's routing options (route-to, reply-to, dup-to) has changed.
If you do not have console access and use these features, review
<a href="//man.openbsd.org/pf.conf">/etc/pf.conf</a> before updating;
the previous syntax will be rejected by
<a href="//man.openbsd.org/pfctl">pfctl(8)</a>.<p>

These options previously accepted an IP address and network interface,
for example:

<blockquote><pre>
    # address is directly reachable via the interfaces (showing both accepted formats)
    pass out proto tcp to port {80 443} route-to 192.0.2.1@ix0
    pass out proto udp to port 53 dup-to (em2 192.168.2.99)

    # using placeholder address to signify the remote address on a point-to-point link
    pass in on pppoe1 reply-to 0.0.0.1@pppoe1
</pre></blockquote>

They now take only an IP address, and perform a route lookup to determine
the interface.
The above examples can now be written like so:

<blockquote><pre>
    # address is directly reachable via the interfaces
    pass out proto tcp to port {80 443} route-to 192.0.2.1
    pass out proto udp to port 53 dup-to 192.168.2.99

    # using :peer to use the remote address on a point-to-point link
    # using (...) to track changes dynamically
    pass in on pppoe1 reply-to (pppoe1:peer)
</pre></blockquote>

Alternatively, for some configurations using these features, it may be
simpler to use multiple route tables instead (using ifconfig's <a
href="//man.openbsd.org/ifconfig.8#rdomain">rdomain</a> and pf.conf's
<a href="//man.openbsd.org/pf.conf.5#rtable">rtable</a> features).


<h3 id="r20210209">2021/02/09 - [packages] PostgreSQL major update</h3>

There was a major update to PostgreSQL 13.1.
Use <tt>pg_upgrade</tt> as described in the
<a href="https://cvsweb.openbsd.org/cgi-bin/cvsweb/~checkout~/ports/databases/postgresql/pkg/README-server?rev=1.31&content-type=text/plain">postgresql-server pkg-readme</a>
or do a dump/restore.


<h3 id="r20210212">2021/02/12 - <tt>/dev/{drm,drmR}</tt> replaced by
<tt>/dev/dri/{card,renderD}</tt></h3>

The path to <a href="https://man.openbsd.org/drm.4">drm(4)</a> device
nodes has changed.
If you upgrade to -current from source, you need to run
 	 
<blockquote><pre>
# cd /dev &amp;&amp; ./MAKEDEV dri
</pre></blockquote>
 	 
to generate the new <tt>/dev/dri/</tt> device nodes.
Be sure to use <a href="//man.openbsd.org/sysmerge">sysmerge(8)</a>
as updates to <tt>/etc/fbtab</tt>, <tt>/etc/X11/xenodm/GiveConsole</tt>,
and <tt>/etc/X11/xenodm/TakeConsole</tt> are required.


<h3 id="r20210301">2021/03/01 - Perl updated to 5.32.1</h3>

Perl has been updated to 5.32.1 and some files are no longer included
and can be removed.

<blockquote><pre>
# rm -r /usr/bin/podselect \
        /usr/lib/libperl.so.20.0 \
        /usr/lib/libperl.so.21.0 \
        /usr/libdata/perl5/*/CORE/dquote_inline.h \
        /usr/libdata/perl5/*/Tie \
        /usr/libdata/perl5/*/auto/Tie \
        /usr/libdata/perl5/Pod/Find.pm \
        /usr/libdata/perl5/Pod/InputObjects.pm \
        /usr/libdata/perl5/Pod/ParseUtils.pm \
        /usr/libdata/perl5/Pod/Parser.pm \
        /usr/libdata/perl5/Pod/PlainText.pm \
        /usr/libdata/perl5/Pod/Select.pm \
        /usr/libdata/perl5/pod/perlce.pod \
        /usr/libdata/perl5/unicore/Heavy.pl \
        /usr/libdata/perl5/unicore/lib/Lb/EB.pl \
        /usr/libdata/perl5/unicore/lib/Perl/_PerlNon.pl \
        /usr/libdata/perl5/unicore/lib/Sc/Armn.pl \
        /usr/libdata/perl5/utf8_heavy.pl \
        /usr/share/man/man1/podselect.1 \
        /usr/share/man/man3p/Pod::Find.3p \
        /usr/share/man/man3p/Pod::InputObjects.3p \
        /usr/share/man/man3p/Pod::ParseUtils.3p \
        /usr/share/man/man3p/Pod::Parser.3p \
        /usr/share/man/man3p/Pod::PlainText.3p \
        /usr/share/man/man3p/Pod::Select.3p
</pre></blockquote>
 	 

<h3 id="r20210303">2021/03/03 - changes in wsconsctl</h3>

For configuring touchpad settings, laptop users should make sure
that wsconsctl is in sync with the kernel.


<h3 id="r20210312">2021/03/12 - IPv6 privacy addresses renamed to temporary addresses</h3>

RFC 8981 changed the terminology from privacy to temporary addresses.
<code>autoconfprivacy</code> in hostname.if(5) files should be changed to
<code>temporary</code>.


<h3 id="r20210329">2021/03/29 - [packages] yubiserve replaced with yubikeyedup</h3>

The "yubiserve" package is unmaintained upstream and requires
an end-of-life version of Python. This has been replaced with
"yubikeyedup". While it is broadly compatible with the most common use
of yubiserve it has its limits: it supports only sqlite3 (using the
same schema as before) not other databases, and it only supports HTTP
internally, if you require HTTPS then you will need to use a proxy (e.g.
relayd or nginx). It no longer uses a configuration file, only command
line arguments.


<!--
     Two blank lines before new sections.
     New sentences start on new lines.
     Try to make lines shorter than 80 characters.
-->

<hr id="end">
<small>$OpenBSD: current.html,v 1.1068 2021/03/29 12:11:22 sthen Exp $</small>
